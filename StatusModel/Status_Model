@startuml
title Статусная модель системы автомойки

[*] --> Заказ_создан

state Заказ_создан
state Заказ_ожидает_оплаты
state Заказ_оплачен
state Клиент_прибыл
state Мойка_в_процессе
state Заказ_завершен
state Есть_жалоба
state Заказ_отменен
state Клиент_не_приехал

state Пользователь_неподтвержден
state Пользователь_подтвержден
state Пользователь_обычный
state Пользователь_VIP
state Пользователь_заблокирован

state Мойщик_свободен
state Мойщик_занят
state Мойщик_на_перерыве

state Бокс_свободен
state Бокс_забронирован
state Бокс_занят
state Бокс_на_обслуживании

state Оплата_ожидание
state Оплата_в_процессе
state Оплата_успех
state Оплата_ошибка
state Оплата_возврат
state Оплата_отменена

' Основной поток заказа
[*] --> Заказ_создан
Заказ_создан --> Заказ_ожидает_оплаты : Бронь
Заказ_создан --> Заказ_отменен : Отмена

Заказ_ожидает_оплаты --> Заказ_оплачен : Оплата
Заказ_ожидает_оплаты --> Заказ_отменен : Отмена

Заказ_оплачен --> Клиент_прибыл : Приезд
Заказ_оплачен --> Клиент_не_приехал : Неявка
Заказ_оплачен --> Заказ_отменен : Отмена

Клиент_прибыл --> Мойка_в_процессе : Начало мойки
Мойка_в_процессе --> Заказ_завершен : Мойка окончена
Мойка_в_процессе --> Есть_жалоба : Проблема

Заказ_завершен --> [*]
Есть_жалоба --> [*]
Заказ_отменен --> [*]
Клиент_не_приехал --> [*]

' Статусы пользователя
Пользователь_неподтвержден --> Пользователь_подтвержден : СМС код
Пользователь_подтвержден --> Пользователь_обычный : Первый заказ
Пользователь_подтвержден --> Пользователь_заблокирован : Нарушения
Пользователь_обычный --> Пользователь_VIP : Условия
Пользователь_обычный --> Пользователь_заблокирован : Нарушения
Пользователь_VIP --> Пользователь_обычный : Условия
Пользователь_VIP --> Пользователь_заблокирован : Нарушения
Пользователь_заблокирован --> Пользователь_обычный : Разблокировка

' Статусы мойщика
Мойщик_свободен --> Мойщик_занят : Назначен заказ
Мойщик_свободен --> Мойщик_на_перерыве : Перерыв
Мойщик_занят --> Мойщик_свободен : Заказ завершен
Мойщик_занят --> Мойщик_на_перерыве : Перерыв
Мойщик_на_перерыве --> Мойщик_свободен : Конец перерыва

' Статусы бокса
Бокс_свободен --> Бокс_забронирован : Бронь
Бокс_свободен --> Бокс_занят : Машина заехала
Бокс_забронирован --> Бокс_занят : Машина заехала
Бокс_забронирован --> Бокс_свободен : Отмена брони
Бокс_занят --> Бокс_на_обслуживании : Поломка
Бокс_занят --> Бокс_свободен : Машина уехала
Бокс_на_обслуживании --> Бокс_свободен : Ремонт завершен

' Статусы оплаты
Оплата_ожидание --> Оплата_в_процессе : Платеж начат
Оплата_ожидание --> Оплата_отменена : Отмена
Оплата_в_процессе --> Оплата_успех : Оплачено
Оплата_в_процессе --> Оплата_ошибка : Сбой
Оплата_ошибка --> Оплата_в_процессе : Повтор
Оплата_ошибка --> Оплата_отменена : Отмена
Оплата_успех --> Оплата_возврат : Возврат средств
Оплата_возврат --> [*]
Оплата_отменена --> [*]

' Связи между статусами
Заказ_ожидает_оплаты --> Оплата_ожидание : требует
Заказ_оплачен --> Оплата_успех : подтверждает
Мойка_в_процессе --> Мойщик_занят : использует
Мойка_в_процессе --> Бокс_занят : использует
Пользователь_обычный --> Заказ_создан : создает

@enduml
